/*
 * Copyright 2017 NXP
 * All rights reserved.
 *
 * SPDX-License-Identifier: BSD-3-Clause
 */
#include "fsl_common.h"
#include "fsl_debug_console.h"
#include "fsl_intmux.h"
#include "fsl_irqsteer.h"
#include "board.h"
#include "app.h"
/*******************************************************************************
 * Definitions
 ******************************************************************************/

/*******************************************************************************
 * Prototypes
 ******************************************************************************/

/*******************************************************************************
 * Variables
 ******************************************************************************/

/* Global variable indicating interrupt is handled*/
volatile bool isrFlag = false;

/*******************************************************************************
 * Code
 ******************************************************************************/

/*!
 * @brief Main function
 */
int main(void)
{
    /* Init board hardware. */
    BOARD_InitHardware();

    PRINTF("INTMUX example started.\r\n");

    /* 1. Init INTMUX, configure the IRQ source routed to system. */
    INTMUX_Init(DEMO_INTMUX_BASE);
    INTMUX_EnableInterrupt(DEMO_INTMUX_BASE, DEMO_INTMUX_CHANNEL, DEMO_INTMUX_SOURCE_IRQ);

    /* 2. Setup the local IRQSTEER to handle the system IRQ generated by INTMUX. */
    /* This step is used to show the interrupt from M4 Subsytem has been routed to system
      and could be used by other subsystem through IRQSTEER.*/
    IRQSTEER_Init(DEMO_IRQSTEER_BASE);
    IRQSTEER_EnableInterrupt(IRQSTEER, DEMO_M4_INT_OUT_IRQn);

    /* 3. Enable the interrupt source (INTMUX input source) */
    DEMO_InitIntmuxSource();

    while (1)
    {
        while (!isrFlag)
        {
        }
        isrFlag = false;
        PRINTF("The interrupt came from INTMUX was handled\r\n");
    }
}
