# TwinCAT project setup

This section lists the steps to set up the TwinCAT project.

## Create a new project 

1.  Import the ESI file of the servo motor example before TwinCAT starts.

    Copy the ESI file '`ECAT-SERVO-MOTOR.xml`' generated by SSC tool under the SSC project saving directory to `<TwinCAT_installation_folder>/<Version>/Config/io/EtherCAT/`.

2.  Select **File \> New \> Project**.

    ![](../images/image16.png "Create new project")

    The **New Project** dialog box appears.

3.  Select **TwinCAT Projects**.
4.  Click **OK**.

    ![](../images/Click_OK.png "Select project ")


## Scan the for subdevices 

1.  In the **Solution Explorer** view, expand **I/O**.
2.  Right-click on **Device** and select **Scan**.

    ![](../images/image17.png "Scan for the devices")

    The scanned devices appear in the **I/O devices found** dialog box.

3.  Select the network interface connected with the MIMXRT1180-EVK board.
4.  Click **OK**.

    ![](../images/image18.png "Devices scanned")


## Update the ESI file to E2PROM 

**Note:** The E2PROM must be updated if the servo motor example is set up first time on the MIMXRT1180-EVK.

1.  Under **Device4**, double-click Box 1 \(ECAT-SERVO-MOTOR\).The **TwinCAT Project** dialog box appears.
2.  Click the **EtherCAT** tab.
3.  Click the **Advanced Settings** button.

    The **Advanced Settings** dialog box appears.

4.  From the left pane of the **Advanced Settings** dialog box, select **ESC Access \> Smart View**.
5.  Click the **Write E2PROM** button.
6.  From the available EEPROM list, **select NXP \> ECAT \> ECAT-SERVO-MOTOR**.

    ![](../images/UpdateESI.png "Update the ESI file to E2PROM")

7.  Click **OK**.

    **Note:** Delete *Device4*, rescan, and add *Device4* after Write E2PROM success.

    ![](../images/image19.png "Write EEPROM")


## Configure the subdevice 

1.  Click **Box 1\(ECAT-SERVO-MOTOR\)**.
2.  Click the **DC** tab.
3.  From the **Operation Mode** field, select the **DC-Synchron** option.

    ![](../images/image20.png "Select the operation mode")


## Select the csp mode 

1.  Click **Box 1\(ECAT-SERVO-MOTOR\)**.
2.  Click the **Slots** tab.
3.  Select *Axis 0’ \> ‘x’*.
4.  Click *Axis 0’ \> ‘csp - axis’ \> ‘<*’ to select the csp mode.

    ![](../images/csp_axis.png "Select slots")

    The results are shown in [Figure 9](#fig_mcz_13z_gzb).

    ![](../images/image21.png "Select the csp mode")


## Add new Axes

1.  Right-click **MOTION** and click **Add New Item**.

    ![](../images/image22.png "Add new item")

    The **Insert Motion Configuration** dialog box appears.

2.  Select **NC/PTP NCI Configuration**.
3.  Click **OK**.

    ![](../images/NC_Configure.png "Select NC/PTP NCI configuration")

4.  Right-click **Axes** and click **Add New Item \> OK**.

    ![](../images/image23.png "Add axes")

    The **Insert NC Axis** dialog box appears.

5.  Provide the name in the **Insert NC Axis** text box.
6.  Click **OK**.

    ![](../images/image24.png "Insert NC Axis")


## Link I/O 

1.  Select **Axes \> Axis1** from the **Solution Explorer**,
2.  Click the **Settings** tab.
3.  Select **Link To I/O \> CANopen DS402, EtherCAT CoE**.
4.  Click **OK**.

    ![](../images/image25.png "Link I/O")


## Configure Enc. 

1.  Select **Axes \> Axis1 \> Enc \> Inputs \> In \> nDataIn1** from the **Solution Explorer**.

    The **TwinCAT Project** dialog box appears.

2.  Click the **\> Linked to** button.

    The **Attached Variable nDataIn1 \(Input\)** dialog box appears.

3.  Select **Box1\(ECAT-SERVO-MOTOR\) \> ActualPosition**.
4.  Select **All Types** checkbox on the right to display all variables.
5.  Click **OK**.

    ![](../images/nDataIn1.png "Configure Enc")

6.  Select **Axis1 \> Enc \>Inputs \> In \> nState4 \> Linked to** from the **Solution Explorer** to link **InputToggle**.

    ![](../images/image27.png "Set InputToggle")

7.  Select **Axes \> Axis1 \> Enc \> Inputs \> In \> nDcInputTime \> Linked to** to link **DcInputShift**.

    ![](../images/image28.png "Link DcInputShift")


## Configure scaling factor 

The encoder density of Tecknic2311P motor is 8,000 counts/rev. Tp configure Scaling Factor 1/8000; convert pulse counters to mm using below formula：

`Target position(mm) = Motor revolutions(counts) * Scaling Factor`

1.  Select **Axes \> Axis1 \> Enc** from the **Solution Explorer**.

    The **TwinCAT Project** dialog box appears.

2.  Click the **Parameter** tab.
3.  Set **Scaling Factor Numerator** to `1`.
4.  Set **Scaling Factor Denominator** to `8000`.

    ![](../images/enc_parameter.png "Configure the scaling factor")


## Configure drive 

1.  Select **Axes \> Axis1 \> Drive \> Inputs \> In \> nState1** from the **Solution Explorer**.

    The **TwinCAT Project** dialog box appears.

2.  Click the **Linked to** button.

    The **Attached Variable nState1 \(Input\)** dialog box appears.

3.  Select **Box1\(ECAT-SERVO-MOTOR\) \> Status Word Linked** to link **StatusWord**.
4.  Click **OK**.

    ![](../images/image30.png "Configure drive")

5.  Click **OK** to link `StatusWord`.

    ![](../images/image31.png "Attach variable nState1 ")

6.  Click **Axes \> Axis1 \> Drive \> Inputs \> In \> nState2 \> Linked to** to link `StatusWord`.

    ![](../images/image32.png "Link StatusWord")

    ![](../images/image33.png "Attach variable nState2")

7.  Click **Axes \> Axis1 \> Drive \> Inputs \> In \> nState4 \> Linked to** to link **WcState**.

    ![](../images/image34.png "WcState and InputToggle")

8.  Click **OK**.

    ![](../images/image35.png "Attach variable nState4")

9.  Click **Axes \> Axis1 \> Drive \> Outputs \> Out \> nDataOut1 \> Linked to** to link **TargetPosition**.

    ![](../images/image36.png "Link TargetPosition")

10. Click **Axes \> Axis1 \> Drive \> Outputs \> Out \> nCtrl1 \> Linked to** to link **ControlWord**.

    ![](../images/image37.png "Link ControlWord")

11. Click **Axes \> Axis1 \> Drive \> Outputs \> Out \> nCtrl2 \> Linked to** to link **ControlWord**.

    ![](../images/image38.png "Attach Variable nCTrl2 (Output)")


## Stop position lag monitoring 

1.  Click **Axes \> Axis1 \> Parameter \> Monitoring \> Position Lag Monitoring** to choose `FALSE`.

    ![](../images/image39.png "Stop position lag monitoring")


## Start to run motor 

1.  Activate the configuration by clicking **TwinCAT \> Activate Configuration**.

    ![](../images/activate_con.png "Activate configuration")

2.  Click **Axes \> Axis1.**
3.  Click the **Online** tab.
4.  Click **Set**.
5.  Set enabling and click **All**.

    ![](../images/image40.png "Start to run motor")

6.  Set **Target Position** and click the **F5** button. The motor will run to the target position.

    ![](../images/image41.png "Set target position")

    **Note:** If the motor does not run and the position bar is gray, follow the following steps.

    1.  Click **Device 4 \> Box 1 \> WcState \> WcState \> Clear Link\(s\)**.
    2.  Click **Device 4 \> Box 1 \> WcState \> InputToggle \> Clear Link\(s\)**.

        ![](../images/image42.png "Clear links")

7.  Repeat step [Start to run motor](#startto)..

