Hardware requirements
=====================
- Micro USB cable
- LPCXpresso54S018M board
- Personal Computer

Board settings
============
No special settings are required.

Prepare the Demo
===============
1.  Connect a micro USB cable between the host PC and the LPC-Link USB port (J8) on the target board.

Running the demo
================
This demo decrypts the key from key code and encrypt data using AES with PUF HW key, 
which are stored in key store

Using flashloader and blhost.exe:
1. Run flashloader to generate a bin with keystore.
	I. 	Build and download flashloader (mcu-sdk-2.0/boards/lpcxpresso54s018m/bootloader_examples/flashloader)
		to the board.
	II.	Run flashloader on board and start executing blhost.exe commands on PC side
2. Generating keystore bin file using blhost.exe
	Note:We are generating only UDS Key Code and Image Key Code. 
		 Firmware Update Key Code is not used (but can be also used for AES).

	I. 	PUF enroll (generate activation code into key store):
			blhost -p COM# -- key-provisioning enroll

	II.	generate  Image Key Code; Image Key type = 1, aes_key.bin is hex file with AES key.
		For valid expected encrypted data please use following key in aes_key.bin file:

		HEX:
		54 68 69 73 70 61 73 73 77 6F 72 64 69 73 76 65 
		72 79 75 6E 63 6F 6D 6D 6F 6E 66 6F 72 68 65 72 
		Plaintext:
		Thispasswordisveryuncommonforher

		Then execute this blhost command 
			blhost -p COM# -- key-provisioning set_user_key 1 aes_key.bin,32

	II.	generate  UDS Key code; UDS key type = 2, uds_key.bin is hex file with our key that we encrypt
		and then decrypt using this example, key size = 32,
			blhost -p COM# -- key-provisioning set_user_key 2 uds_key.bin,32

	III.upload the key store in to the PC; key_store.bin will contain activation code and Key Codes
			blhost -p COM# -- key-provisioning read_key_store key_store.bin

3. Get activation code and Key Codes from key_store.bin
	I.	open key_store.bin in any hex editor

	II.	first 1192 bytes of key_store.bin is activation code which needs to be copied into 
		uint8_t activationCode[PUF_ACTIVATION_CODE_SIZE] array in source file puf_flashloader_test.c

	III.Image Key Code size is 52 bytes long and can be located at offset 0x04A8 in key_store.bin and needs to be copied into
		uint8_t ImageKeyCode[] array in source file puf_flashloader_test.c

	IV.UDS Key Code size is 52 bytes long and can be located at offset 0x04DC in key_store.bin and needs to be copied into
		uint8_t UDSKeyCode[] array in source file puf_flashloader_test.c

4.	Build and download puf_flashloader_test to the target board
5.  Open a serial terminal with the following settings:
    - 115200 baud rate
    - 8 data bits
    - No parity
    - One stop bit
    - No flow control
6.	In terminal you should be able to see reconstructed key, which you choose in step 2(III.)

The log below shows the output of the PUF flashloader test in the terminal window (the key value will vary):
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
PUF flashloader test

Reconstructed intrinsic key = 6d796e657770617373776f72643132336d796e657770617373776f7264313233
AES encryption with PUF HW key success!



Test ends with success
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
