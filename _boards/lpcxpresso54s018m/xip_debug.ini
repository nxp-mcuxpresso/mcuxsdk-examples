/* This file is used to redefine the behavior of the IDE reset button to run from application */

FUNC void setup(void)
{
    SP = _RDWORD(0x10000000);        /* Load the SP value from external flash vector table. */
    PC = _RDWORD(0x10000004);        /* Load the PC value from external flash vector table. */
    _WDWORD(0xE000ED08, 0x10000000); /* Relocat the vector vable to external flash table.   */
}

FUNC void spifi_init(void)
{
	  _WDWORD(0x40000200, 0x02783);    /* Enable IOCON SPIFI clock */
	
	  _WDWORD(0x4000105C, 0x00000326); /* PIO0_23  SPIFI_CSN  */
	  _WDWORD(0x40001060, 0x00000326); /* PIO0_24  SPIFI_IO(0)*/
	  _WDWORD(0x40001064, 0x00000326); /* PIO0_25  SPIFI_IO(1)*/
	  _WDWORD(0x40001068, 0x00000326); /* PIO0_26  SPIFI_CLK  */
	  _WDWORD(0x4000106C, 0x00000326); /* PIO0_27  SPIFI_IO(2)*/
	  _WDWORD(0x40001070, 0x00000326); /* PIO0_28  SPIFI_IO(3)*/
	  
	  _WDWORD(0x40000630, 0x00000010); /* Enable FRO HF power */
	  _WDWORD(0x40000500, 0x40A65769); /* Set FRO 96Mhz */
	  _WDWORD(0x400002A0, 0x00000003); /* SPIFI clock set to FRO */	  

	
	  _WDWORD(0x40000390, 0x00000000); /* SPIFI clock div to 1 */
		
	  _WDWORD(0x4008001C, 0x10);       /* SPIFI reset */

	  _WDWORD(0x40080000, 0x600FFFFF); /* SPIFI init */
	
	  _WDWORD(0x40080018, 0x0B810000); /* SPIFI CMD read */
}

FUNC void OnResetExec(void){
  _WDWORD(0x40000000, 0x2);          /* Setup remap: Interrupt vectors are not re-mapped */
  spifi_init();
  setup();
}

//g, main /* Run to main. */
